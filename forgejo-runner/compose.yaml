services:
  runner:
    image: code.forgejo.org/forgejo/runner:3.3.0
    container_name: forgejo_runner
    restart: unless-stopped
    privileged: true
    user: root
    environment:
      - DOCKER_HOST=unix:///var/run/docker.sock
      # Forgejo instance URL — use Caddy domain, never a raw IP
      - GITEA_INSTANCE_URL=${GITEA_INSTANCE_URL}
      # Registration token from: Site Admin → Actions → Runners → Create new
      - GITEA_RUNNER_REGISTRATION_TOKEN=${GITEA_RUNNER_TOKEN}
      - GITEA_RUNNER_NAME=dockge-runner
      - GITEA_RUNNER_LABELS=local-shell:docker://node:20-bullseye,ubuntu-latest:docker://node:20-bullseye
    volumes:
      - ./data:/data
      - ./entrypoint.sh:/entrypoint.sh:ro
      - /var/run/docker.sock:/var/run/docker.sock
      - /opt/stacks:/opt/stacks
      - /opt/cti-dev:/opt/cti-dev
    networks:
      - cti-net
    entrypoint: /entrypoint.sh
networks:
  cti-net:
    external: true
