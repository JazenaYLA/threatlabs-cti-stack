services:
  # ─── CaddyManager ───────────────────────────────
  # Web UI for managing Caddy servers via Admin API
  # Repo: https://github.com/JazenaYLA/caddymanager

  caddymanager-backend:
    image: caddymanager/caddymanager-backend:latest
    container_name: caddymanager-backend
    restart: unless-stopped
    environment:
      - PORT=3000
      # Database — SQLite for zero-config
      - DB_ENGINE=sqlite
      - SQLITE_DB_PATH=/app/data/caddymanager.sqlite
      # Caddy Admin API on the Caddy LXC
      - CADDY_SANDBOX_URL=http://${CADDY_LXC_IP}:2019
      # CORS — allow frontend origin
      - CORS_ORIGIN=http://${DOCKGE_HOST}:${CADDYMANAGER_PORT:-8190}
      - LOG_LEVEL=info
      - PING_INTERVAL=30000
      - PING_TIMEOUT=2000
      - AUDIT_LOG_MAX_SIZE_MB=100
      - AUDIT_LOG_RETENTION_DAYS=90
      - METRICS_HISTORY_MAX=1000
      - JWT_SECRET=${JWT_SECRET}
      - JWT_EXPIRATION=24h
    volumes:
      - caddymanager_data:/app/data
    networks:
      - cti-net
  caddymanager-frontend:
    image: caddymanager/caddymanager-frontend:latest
    container_name: caddymanager-frontend
    restart: unless-stopped
    depends_on:
      - caddymanager-backend
    environment:
      - BACKEND_HOST=caddymanager-backend:3000
      - APP_NAME=Caddy Manager
      - DARK_MODE=true
    ports:
      - ${CADDYMANAGER_PORT:-8190}:80
    networks:
      - cti-net
  # ─── CaddyGen ───────────────────────────────────
  # Caddy config generator UI (standalone)
  # Repo: https://github.com/JazenaYLA/CaddyGen

  caddygen:
    image: wardy784/caddygen:latest
    container_name: caddygen
    restart: unless-stopped
    ports:
      - ${CADDYGEN_PORT:-8189}:80
    networks:
      - cti-net
networks:
  cti-net:
    external: true
volumes:
  caddymanager_data:
